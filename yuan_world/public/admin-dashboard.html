<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理后台 - 源世界</title>
    <style>
        :root { --main-color: #90EE90; --dark-bg: #121212; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--dark-bg); color: #fff; line-height: 1.6; display: flex; }
        
        /* 侧边栏 */
        .sidebar { width: 260px; background: #1a1a1a; border-right: 1px solid #333; height: 100vh; position: fixed; left: 0; top: 0; overflow-y: auto; }
        .sidebar-header { padding: 25px 20px; border-bottom: 1px solid #333; }
        .sidebar-logo { font-size: 1.5rem; font-weight: bold; background: linear-gradient(135deg, #90EE90, #37B679); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sidebar-menu { padding: 20px 0; }
        .menu-group { margin-bottom: 30px; }
        .menu-group-title { font-size: 0.75rem; text-transform: uppercase; opacity: 0.5; padding: 0 20px; margin-bottom: 10px; font-weight: 600; }
        .menu-item { padding: 12px 20px; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; gap: 10px; border-left: 3px solid transparent; }
        .menu-item:hover { background: rgba(144,238,144,0.1); border-left-color: var(--main-color); }
        .menu-item.active { background: rgba(144,238,144,0.15); border-left-color: var(--main-color); color: var(--main-color); }
        
        /* 主内容区 */
        .main-content { margin-left: 260px; flex: 1; padding: 30px; }
        
        /* 顶部栏 */
        .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #333; }
        .topbar-title { font-size: 2rem; font-weight: 700; }
        .topbar-actions { display: flex; gap: 15px; align-items: center; }
        
        /* 统计卡片 */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #1a1a1a, #252525); border-radius: 15px; padding: 25px; border: 2px solid #333; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); border-color: var(--main-color); }
        .stat-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .stat-icon { font-size: 2rem; }
        .stat-label { font-size: 0.9rem; opacity: 0.7; margin-bottom: 10px; }
        .stat-value { font-size: 2.5rem; font-weight: 700; color: var(--main-color); }
        .stat-change { font-size: 0.85rem; margin-top: 10px; }
        .stat-up { color: #4ade80; }
        .stat-down { color: #f87171; }
        
        /* 内容面板 */
        .content-panel { display: none; }
        .content-panel.active { display: block; animation: fadeIn 0.3s; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* 表格 */
        .data-table { background: #1a1a1a; border-radius: 12px; border: 2px solid #333; overflow: hidden; }
        .table-header { padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .table-title { font-size: 1.2rem; font-weight: 600; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: #222; }
        th { padding: 15px; text-align: left; font-weight: 600; font-size: 0.9rem; opacity: 0.8; }
        td { padding: 15px; border-top: 1px solid #333; }
        tr:hover td { background: rgba(144,238,144,0.05); }
        
        /* 按钮 */
        .btn { padding: 8px 20px; border: none; border-radius: 20px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-primary { background: linear-gradient(135deg, #90EE90, #37B679); color: #111; }
        .btn-secondary { background: #333; color: #fff; }
        .btn-danger { background: #dc2626; color: #fff; }
        .btn:hover { transform: translateY(-2px); }
        
        /* 搜索框 */
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-input { flex: 1; padding: 12px; background: #222; border: 2px solid #333; border-radius: 8px; color: #fff; font-size: 1rem; }
        .search-input:focus { outline: none; border-color: var(--main-color); }
        
        /* 角色标签 */
        .role-badge { padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; }
        .role-admin { background: #dc2626; color: #fff; }
        .role-staff { background: #3b82f6; color: #fff; }
        .role-finance { background: #f59e0b; color: #fff; }
        
        /* 状态标签 */
        .status-badge { padding: 4px 12px; border-radius: 12px; font-size: 0.8rem; font-weight: 600; }
        .status-success { background: #22c55e; color: #fff; }
        .status-pending { background: #f59e0b; color: #fff; }
        .status-failed { background: #dc2626; color: #fff; }
    </style>
</head>
<body>
    <!-- 侧边栏 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">源世界 管理后台</div>
            <div style="font-size: 0.85rem; opacity: 0.7; margin-top: 5px;" id="adminRole">管理员</div>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-group">
                <div class="menu-group-title">概览</div>
                <div class="menu-item active" onclick="switchPanel('overview')">
                    <span>📊</span>
                    <span>数据概览</span>
                </div>
            </div>
            
            <div class="menu-group">
                <div class="menu-group-title">用户管理</div>
                <div class="menu-item" onclick="switchPanel('users')">
                    <span>👥</span>
                    <span>用户列表</span>
                </div>
                <div class="menu-item" onclick="switchPanel('vip')">
                    <span>💎</span>
                    <span>VIP用户</span>
                </div>
            </div>
            
            <div class="menu-group">
                <div class="menu-group-title">订单管理</div>
                <div class="menu-item" onclick="switchPanel('orders')">
                    <span>📦</span>
                    <span>订单列表</span>
                </div>
                <div class="menu-item" onclick="switchPanel('recharges')">
                    <span>💰</span>
                    <span>充值记录</span>
                </div>
            </div>
            
            <div class="menu-group">
                <div class="menu-group-title">内容管理</div>
                <div class="menu-item" onclick="switchPanel('generations')">
                    <span>🎨</span>
                    <span>生成记录</span>
                </div>
                <div class="menu-item" onclick="switchPanel('templates')">
                    <span>🖼️</span>
                    <span>模板管理</span>
                </div>
            </div>
            
            <div class="menu-group">
                <div class="menu-group-title">系统</div>
                <div class="menu-item" onclick="switchPanel('settings')">
                    <span>⚙️</span>
                    <span>系统设置</span>
                </div>
                <div class="menu-item" onclick="logout()">
                    <span>🚪</span>
                    <span>退出登录</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 主内容区 -->
    <div class="main-content">
        <!-- 数据概览 -->
        <div id="overview" class="content-panel active">
            <div class="topbar">
                <h1 class="topbar-title">数据概览</h1>
                <div class="topbar-actions">
                    <select style="padding: 8px 16px; background: #222; border: 2px solid #333; border-radius: 8px; color: #fff;">
                        <option>今日</option>
                        <option>本周</option>
                        <option>本月</option>
                        <option>全部</option>
                    </select>
                    <button class="btn btn-primary">📊 导出报表</button>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">👥</div>
                    </div>
                    <div class="stat-label">总用户数</div>
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-change stat-up">↑ 今日新增: <span id="newUsersToday">0</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">💰</div>
                    </div>
                    <div class="stat-label">总收入</div>
                    <div class="stat-value">¥<span id="totalRevenue">0</span></div>
                    <div class="stat-change stat-up">↑ 今日: ¥<span id="revenueToday">0</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">🎨</div>
                    </div>
                    <div class="stat-label">生成次数</div>
                    <div class="stat-value" id="totalGenerations">0</div>
                    <div class="stat-change stat-up">↑ 今日: <span id="generationsToday">0</span></div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">💎</div>
                    </div>
                    <div class="stat-label">VIP用户</div>
                    <div class="stat-value" id="vipUsers">0</div>
                    <div class="stat-change stat-up">↑ 本月: <span id="vipThisMonth">0</span></div>
                </div>
            </div>
            
            <div class="data-table">
                <div class="table-header">
                    <div class="table-title">最近订单</div>
                    <button class="btn btn-secondary" onclick="switchPanel('orders')">查看全部</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>订单号</th>
                            <th>用户</th>
                            <th>类型</th>
                            <th>金额</th>
                            <th>状态</th>
                            <th>时间</th>
                        </tr>
                    </thead>
                    <tbody id="recentOrders">
                        <tr>
                            <td colspan="6" style="text-align: center; opacity: 0.5; padding: 40px;">暂无数据</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 用户列表 -->
        <div id="users" class="content-panel">
            <div class="topbar">
                <h1 class="topbar-title">用户列表</h1>
                <div class="topbar-actions">
                    <button class="btn btn-primary">📥 导出用户</button>
                </div>
            </div>
            
            <div class="search-box">
                <input type="text" class="search-input" placeholder="搜索用户名或邮箱..." id="userSearch">
                <button class="btn btn-primary" onclick="searchUsers()">🔍 搜索</button>
            </div>
            
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>用户名</th>
                            <th>邮箱</th>
                            <th>余额</th>
                            <th>VIP</th>
                            <th>注册时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="usersList">
                        <tr>
                            <td colspan="7" style="text-align: center; opacity: 0.5; padding: 40px;">加载中...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 订单列表 -->
        <div id="orders" class="content-panel">
            <div class="topbar">
                <h1 class="topbar-title">订单列表</h1>
                <div class="topbar-actions">
                    <button class="btn btn-primary">📥 导出订单</button>
                </div>
            </div>
            
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>订单号</th>
                            <th>用户</th>
                            <th>类型</th>
                            <th>金额</th>
                            <th>状态</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="ordersList">
                        <tr>
                            <td colspan="7" style="text-align: center; opacity: 0.5; padding: 40px;">暂无订单</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- VIP用户 -->
        <div id="vip" class="content-panel">
            <div class="topbar">
                <h1 class="topbar-title">VIP用户管理</h1>
            </div>
            
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>用户名</th>
                            <th>VIP等级</th>
                            <th>开通时间</th>
                            <th>到期时间</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="vipList">
                        <tr>
                            <td colspan="6" style="text-align: center; opacity: 0.5; padding: 40px;">暂无VIP用户</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 生成记录 -->
        <div id="generations" class="content-panel">
            <div class="topbar">
                <h1 class="topbar-title">生成记录</h1>
            </div>
            
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>用户</th>
                            <th>模式</th>
                            <th>预览图</th>
                            <th>是否付费</th>
                            <th>生成时间</th>
                        </tr>
                    </thead>
                    <tbody id="generationsList">
                        <tr>
                            <td colspan="6" style="text-align: center; opacity: 0.5; padding: 40px;">加载中...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- 其他面板省略... -->
        <div id="recharges" class="content-panel">
            <div class="topbar">
                <h1 class="topbar-title">充值记录</h1>
            </div>
            <p style="text-align: center; opacity: 0.5; padding: 60px;">充值记录功能开发中...</p>
        </div>
        
        <div id="templates" class="content-panel">
            <div class="topbar">
                <h1 class="topbar-title">模板管理</h1>
            </div>
            <p style="text-align: center; opacity: 0.5; padding: 60px;">模板管理功能开发中...</p>
        </div>
        
        <div id="settings" class="content-panel">
            <div class="topbar">
                <h1 class="topbar-title">系统设置</h1>
            </div>
            <p style="text-align: center; opacity: 0.5; padding: 60px;">系统设置功能开发中...</p>
        </div>
    </div>
    
    <script>
        let currentToken = null;
        let currentAdmin = null;
        
        // 页面加载
        document.addEventListener('DOMContentLoaded', async () => {
            currentToken = localStorage.getItem('token');
            if (!currentToken) {
                alert('请先登录');
                location.href = 'create.html';
                return;
            }
            
            await loadDashboardData();
        });
        
        // 加载仪表板数据
        async function loadDashboardData() {
            try {
                // 加载统计数据
                await loadStats();
                
                // 加载用户列表
                await loadUsers();
                
                // 加载生成记录
                await loadGenerations();
                
            } catch (error) {
                console.error('加载数据失败:', error);
            }
        }
        
        // 加载统计数据
        async function loadStats() {
            try {
                const response = await fetch('/api/admin/stats', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('totalUsers').textContent = data.totalUsers || 0;
                    document.getElementById('newUsersToday').textContent = data.newUsersToday || 0;
                    document.getElementById('totalRevenue').textContent = data.totalRevenue || 0;
                    document.getElementById('revenueToday').textContent = data.revenueToday || 0;
                    document.getElementById('totalGenerations').textContent = data.totalGenerations || 0;
                    document.getElementById('generationsToday').textContent = data.generationsToday || 0;
                    document.getElementById('vipUsers').textContent = data.vipUsers || 0;
                    document.getElementById('vipThisMonth').textContent = data.vipThisMonth || 0;
                }
            } catch (error) {
                console.error('加载统计数据失败:', error);
            }
        }
        
        // 加载用户列表
        async function loadUsers() {
            try {
                const response = await fetch('/api/admin/users', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const users = data.users || [];
                    
                    const tbody = document.getElementById('usersList');
                    if (users.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; opacity: 0.5; padding: 40px;">暂无用户</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = users.map(user => `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>${user.email || '-'}</td>
                            <td>¥${user.balance || 0}</td>
                            <td>${user.is_vip ? '<span class="status-badge status-success">VIP</span>' : '-'}</td>
                            <td>${new Date(user.created_at).toLocaleString()}</td>
                            <td>
                                <button class="btn btn-secondary" style="padding: 4px 12px; font-size: 0.8rem;">详情</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('加载用户列表失败:', error);
            }
        }
        
        // 加载生成记录
        async function loadGenerations() {
            try {
                const response = await fetch('/api/admin/generations', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const generations = data.generations || [];
                    
                    const tbody = document.getElementById('generationsList');
                    if (generations.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; opacity: 0.5; padding: 40px;">暂无生成记录</td></tr>';
                        return;
                    }
                    
                    tbody.innerHTML = generations.map(gen => `
                        <tr>
                            <td>${gen.id}</td>
                            <td>${gen.user?.username || '-'}</td>
                            <td>${gen.mode || '-'}</td>
                            <td><img src="${gen.preview_url}" style="width: 60px; height: 80px; object-fit: cover; border-radius: 5px;"></td>
                            <td>${gen.is_paid ? '<span class="status-badge status-success">已付费</span>' : '<span class="status-badge status-pending">预览</span>'}</td>
                            <td>${new Date(gen.created_at).toLocaleString()}</td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('加载生成记录失败:', error);
            }
        }
        
        // 切换面板
        function switchPanel(panelName) {
            document.querySelectorAll('.menu-item').forEach(item => item.classList.remove('active'));
            document.querySelectorAll('.content-panel').forEach(panel => panel.classList.remove('active'));
            
            event.target.closest('.menu-item').classList.add('active');
            document.getElementById(panelName).classList.add('active');
        }
        
        // 搜索用户
        function searchUsers() {
            const keyword = document.getElementById('userSearch').value;
            console.log('搜索用户:', keyword);
            // TODO: 实现搜索功能
        }
        
        // 退出登录
        function logout() {
            localStorage.removeItem('token');
            location.href = 'index.html';
        }
    </script>
</body>
</html>










