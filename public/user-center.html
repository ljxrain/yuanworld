<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººä¸­å¿ƒ - åšä¸–ç•Œ</title>
    <style>
        :root { --main-color: #90EE90; --dark-bg: #121212; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--dark-bg); color: #fff; line-height: 1.6; }
        
        /* å¯¼èˆªæ  */
        nav { position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; background: rgba(0,0,0,0.95); backdrop-filter: blur(10px); padding: 15px 0; border-bottom: 1px solid rgba(144,238,144,0.2); }
        .nav-content { max-width: 1400px; margin: 0 auto; padding: 0 40px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; background: linear-gradient(135deg, #90EE90, #37B679); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none; }
        .nav-links { display: flex; gap: 30px; align-items: center; }
        .nav-link { color: #fff; font-weight: 500; text-decoration: none; transition: color 0.3s; }
        .nav-link:hover { color: #90EE90; }
        
        .container { max-width: 1200px; margin: 100px auto 40px; padding: 0 20px; }
        
        /* ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ */
        .user-header { background: linear-gradient(135deg, #1a1a1a, #252525); border-radius: 20px; padding: 40px; margin-bottom: 30px; border: 2px solid #333; }
        .user-info { display: flex; align-items: center; gap: 30px; }
        .user-avatar { width: 100px; height: 100px; border-radius: 50%; background: linear-gradient(135deg, #90EE90, #37B679); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; color: #111; }
        .user-details h2 { font-size: 2rem; margin-bottom: 10px; }
        .user-meta { display: flex; gap: 20px; margin-top: 15px; }
        .meta-item { background: rgba(144,238,144,0.1); padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; }
        
        /* VIPå¾½ç«  */
        .vip-badge { background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; padding: 5px 15px; border-radius: 15px; font-weight: 600; font-size: 0.85rem; }
        
        /* ä½™é¢å¡ç‰‡ */
        .balance-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .balance-card { background: linear-gradient(135deg, #1a1a1a, #252525); border-radius: 15px; padding: 30px; border: 2px solid #333; text-align: center; transition: transform 0.3s; }
        .balance-card:hover { transform: translateY(-5px); border-color: var(--main-color); }
        .balance-label { font-size: 0.9rem; opacity: 0.7; margin-bottom: 10px; }
        .balance-amount { font-size: 2.5rem; font-weight: 700; color: var(--main-color); }
        .balance-unit { font-size: 1rem; opacity: 0.8; }
        
        /* æŒ‰é’® */
        .btn { padding: 12px 30px; border: none; border-radius: 25px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-block; }
        .btn-primary { background: linear-gradient(135deg, #90EE90, #37B679); color: #111; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(144,238,144,0.4); }
        .btn-secondary { background: #333; color: #fff; }
        .btn-secondary:hover { background: #444; }
        
        /* æ ‡ç­¾é¡µ */
        .tabs { display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 2px solid #333; }
        .tab { padding: 15px 30px; cursor: pointer; border: none; background: none; color: #fff; opacity: 0.6; font-size: 1rem; font-weight: 600; border-bottom: 3px solid transparent; transition: all 0.3s; }
        .tab:hover { opacity: 1; }
        .tab.active { opacity: 1; color: var(--main-color); border-bottom-color: var(--main-color); }
        
        /* å†…å®¹åŒºåŸŸ */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        /* ä½œå“åˆ—è¡¨ */
        .works-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px; }
        .work-card { background: #1a1a1a; border-radius: 12px; overflow: hidden; border: 2px solid #333; transition: all 0.3s; cursor: pointer; }
        .work-card:hover { transform: scale(1.05); border-color: var(--main-color); }
        .work-image { width: 100%; aspect-ratio: 2/3; background: #222; object-fit: cover; }
        .work-info { padding: 15px; }
        .work-title { font-size: 0.9rem; margin-bottom: 5px; }
        .work-status { font-size: 0.8rem; opacity: 0.7; }
        .status-paid { color: var(--main-color); }
        .status-preview { color: #FFA500; }
        
        /* è®¢å•åˆ—è¡¨ */
        .order-list { display: flex; flex-direction: column; gap: 15px; }
        .order-card { background: #1a1a1a; border-radius: 12px; padding: 20px; border: 2px solid #333; }
        .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .order-id { font-size: 0.9rem; opacity: 0.7; }
        .order-amount { font-size: 1.3rem; font-weight: 700; color: var(--main-color); }
        .order-details { display: flex; flex-direction: column; gap: 8px; font-size: 0.9rem; }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state { text-align: center; padding: 60px 20px; opacity: 0.6; }
        .empty-state-icon { font-size: 4rem; margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav>
        <div class="nav-content">
            <a href="/yuan/index.html" class="logo">åšä¸–ç•Œ</a>
            <div class="nav-links">
                <a href="/yuan/index.html" class="nav-link">é¦–é¡µ</a>
                <a href="/yuan/gallery.html" class="nav-link">æ¨¡æ¿ä¸­å¿ƒ</a>
                <a href="/yuan/create.html" class="nav-link">ç«‹å³åˆ›ä½œ</a>
                <a href="/yuan/user-center.html" class="nav-link" style="color: #90EE90;">ä¸ªäººä¸­å¿ƒ</a>
                <button class="btn btn-secondary" onclick="logout()" style="padding: 8px 20px;">é€€å‡ºç™»å½•</button>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
        <div class="user-header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-details">
                    <h2 id="username">åŠ è½½ä¸­...</h2>
                    <div class="user-meta">
                        <span class="meta-item" id="userEmail">é‚®ç®±: æœªè®¾ç½®</span>
                        <span class="meta-item">æ³¨å†Œæ—¶é—´: <span id="registerDate">-</span></span>
                        <span class="vip-badge" id="vipBadge" style="display: none;">ğŸ’ VIPä¼šå‘˜</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ä½™é¢å¡ç‰‡ -->
        <div class="balance-cards">
            <div class="balance-card">
                <div class="balance-label">è´¦æˆ·ä½™é¢</div>
                <div class="balance-amount" id="balance">0</div>
                <div class="balance-unit">å…ƒ</div>
                <button class="btn btn-primary" style="margin-top: 15px;" onclick="showRechargeModal()">ğŸ’° å……å€¼</button>
            </div>
            
            <div class="balance-card">
                <div class="balance-label">å‰©ä½™é¢„è§ˆæ¬¡æ•°</div>
                <div class="balance-amount" id="previewCount">0</div>
                <div class="balance-unit">æ¬¡</div>
                <button class="btn btn-secondary" style="margin-top: 15px;" onclick="location.href='create.html'">ğŸ¨ å»åˆ›ä½œ</button>
            </div>
            
            <div class="balance-card">
                <div class="balance-label">VIPçŠ¶æ€</div>
                <div class="balance-amount" id="vipStatus" style="font-size: 1.5rem;">æ™®é€šç”¨æˆ·</div>
                <div class="balance-unit" id="vipExpiry">-</div>
                <button class="btn btn-primary" id="vipBtn" style="margin-top: 15px;" onclick="showVipModal()">ğŸ’ å¼€é€šVIP</button>
            </div>
        </div>
        
        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('works')">æˆ‘çš„ä½œå“</button>
            <button class="tab" onclick="switchTab('orders')">æ¶ˆè´¹è®°å½•</button>
            <button class="tab" onclick="switchTab('settings')">è´¦æˆ·è®¾ç½®</button>
        </div>
        
        <!-- æˆ‘çš„ä½œå“ -->
        <div id="works" class="tab-content active">
            <div class="works-grid" id="worksGrid">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“¸</div>
                    <p>è¿˜æ²¡æœ‰ä½œå“ï¼Œå¿«å»åˆ›ä½œå§ï¼</p>
                </div>
            </div>
        </div>
        
        <!-- æ¶ˆè´¹è®°å½• -->
        <div id="orders" class="tab-content">
            <div class="order-list" id="orderList">
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“‹</div>
                    <p>æš‚æ— æ¶ˆè´¹è®°å½•</p>
                </div>
            </div>
        </div>
        
        <!-- è´¦æˆ·è®¾ç½® -->
        <div id="settings" class="tab-content">
            <div style="background: #1a1a1a; border-radius: 12px; padding: 30px; border: 2px solid #333;">
                <h3 style="margin-bottom: 20px;">è´¦æˆ·è®¾ç½®</h3>
                <div style="display: flex; flex-direction: column; gap: 20px;">
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">ç”¨æˆ·å</label>
                        <input type="text" id="settingUsername" style="width: 100%; padding: 12px; background: #222; border: 2px solid #333; border-radius: 8px; color: #fff; font-size: 1rem;" readonly>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 8px; font-weight: 600;">é‚®ç®±</label>
                        <input type="email" id="settingEmail" style="width: 100%; padding: 12px; background: #222; border: 2px solid #333; border-radius: 8px; color: #fff; font-size: 1rem;">
                    </div>
                    <div>
                        <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ä¿å­˜è®¾ç½®</button>
                        <button class="btn btn-secondary" onclick="showChangePasswordModal()" style="margin-left: 10px;">ğŸ”’ ä¿®æ”¹å¯†ç </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å……å€¼å¼¹çª— -->
    <div id="rechargeModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: #1a1a1a; padding: 40px; border-radius: 20px; max-width: 500px; width: 90%; border: 2px solid var(--main-color);">
            <h2 style="margin-bottom: 30px; color: var(--main-color);">ğŸ’° è´¦æˆ·å……å€¼</h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
                <button class="btn btn-secondary" onclick="selectAmount(10)" style="padding: 20px;">Â¥10</button>
                <button class="btn btn-secondary" onclick="selectAmount(50)" style="padding: 20px;">Â¥50</button>
                <button class="btn btn-secondary" onclick="selectAmount(100)" style="padding: 20px;">Â¥100</button>
                <button class="btn btn-secondary" onclick="selectAmount(200)" style="padding: 20px;">Â¥200</button>
                <button class="btn btn-secondary" onclick="selectAmount(500)" style="padding: 20px;">Â¥500</button>
                <button class="btn btn-secondary" onclick="showCustomAmount()" style="padding: 20px;">è‡ªå®šä¹‰</button>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 10px;">å……å€¼é‡‘é¢</label>
                <input type="number" id="rechargeAmount" placeholder="è¯·è¾“å…¥å……å€¼é‡‘é¢" style="width: 100%; padding: 12px; background: #222; border: 2px solid #333; border-radius: 8px; color: #fff; font-size: 1rem;">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeRechargeModal()" style="flex: 1;">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="processRecharge()" style="flex: 1;">ç¡®è®¤å……å€¼</button>
            </div>
        </div>
    </div>
    
    <!-- VIPè´­ä¹°å¼¹çª— -->
    <div id="vipModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; align-items: center; justify-content: center;">
        <div style="background: #1a1a1a; padding: 40px; border-radius: 20px; max-width: 600px; width: 90%; border: 2px solid #FFD700;">
            <h2 style="margin-bottom: 20px; background: linear-gradient(135deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ğŸ’ å¼€é€šVIPä¼šå‘˜</h2>
            <p style="margin-bottom: 30px; opacity: 0.8;">äº«å—æ›´å¤šç‰¹æƒå’Œä¼˜æƒ </p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin-bottom: 30px;">
                <div class="vip-plan" onclick="selectVipPlan(1, 30)" style="background: #222; padding: 25px; border-radius: 12px; border: 2px solid #333; cursor: pointer; text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ğŸ“…</div>
                    <div style="font-weight: 700; font-size: 1.2rem; margin-bottom: 5px;">æœˆå¡</div>
                    <div style="color: var(--main-color); font-size: 1.5rem; font-weight: 700;">Â¥30</div>
                </div>
                <div class="vip-plan" onclick="selectVipPlan(3, 80)" style="background: #222; padding: 25px; border-radius: 12px; border: 2px solid #333; cursor: pointer; text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ğŸ“†</div>
                    <div style="font-weight: 700; font-size: 1.2rem; margin-bottom: 5px;">å­£å¡</div>
                    <div style="color: var(--main-color); font-size: 1.5rem; font-weight: 700;">Â¥80</div>
                    <div style="font-size: 0.8rem; color: #FFA500;">çœÂ¥10</div>
                </div>
                <div class="vip-plan" onclick="selectVipPlan(12, 288)" style="background: #222; padding: 25px; border-radius: 12px; border: 2px solid #FFD700; cursor: pointer; text-align: center;">
                    <div style="font-size: 1.5rem; margin-bottom: 10px;">ğŸ</div>
                    <div style="font-weight: 700; font-size: 1.2rem; margin-bottom: 5px;">å¹´å¡</div>
                    <div style="color: var(--main-color); font-size: 1.5rem; font-weight: 700;">Â¥288</div>
                    <div style="font-size: 0.8rem; color: #FFD700;">çœÂ¥72</div>
                </div>
            </div>
            
            <div style="background: rgba(255,215,0,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h4 style="margin-bottom: 15px;">VIPç‰¹æƒ</h4>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin-bottom: 8px;">âœ… æ¯æ—¥é¢„è§ˆæ¬¡æ•°ç¿»å€</li>
                    <li style="margin-bottom: 8px;">âœ… ä¸‹è½½é«˜æ¸…å›¾ç‰‡8æŠ˜ä¼˜æƒ </li>
                    <li style="margin-bottom: 8px;">âœ… ä¼˜å…ˆä½¿ç”¨æ–°åŠŸèƒ½</li>
                    <li style="margin-bottom: 8px;">âœ… ä¸“å±å®¢æœæ”¯æŒ</li>
                </ul>
            </div>
            
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" onclick="closeVipModal()" style="flex: 1;">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="processVipPurchase()" style="flex: 1;">ç«‹å³å¼€é€š</button>
            </div>
        </div>
    </div>
    
    <script>
        // æ™ºèƒ½å¤„ç†å›¾ç‰‡è·¯å¾„ï¼Œç¡®ä¿æœ‰æ­£ç¡®çš„å‰ç¼€
        function fixImagePath(url) {
            if (!url) return '';
            if (url.startsWith('/yuan')) return url;
            return '/yuan' + url;
        }
        let currentUser = null;
        let currentToken = null;
        let selectedVipMonths = 1;
        let selectedVipPrice = 30;
        
        // é¡µé¢åŠ è½½
        document.addEventListener('DOMContentLoaded', async () => {
            currentToken = localStorage.getItem('token');
            if (!currentToken) {
                alert('è¯·å…ˆç™»å½•');
                location.href = 'create.html';
                return;
            }
            
            await loadUserData();
            await loadWorks();
            await loadOrders();
        });
        
        // åŠ è½½ç”¨æˆ·æ•°æ®
        async function loadUserData() {
            try {
                const response = await fetch('/yuan/api/auth/me', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                if (!response.ok) throw new Error('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥');
                
                const data = await response.json();
                currentUser = data.user;
                
                // æ›´æ–°é¡µé¢ä¿¡æ¯
                document.getElementById('username').textContent = currentUser.username;
                document.getElementById('userAvatar').textContent = currentUser.username[0].toUpperCase();
                document.getElementById('userEmail').textContent = `é‚®ç®±: ${currentUser.email || 'æœªè®¾ç½®'}`;
                document.getElementById('registerDate').textContent = new Date(currentUser.created_at).toLocaleDateString();
                
                // ä½™é¢å’Œæ¬¡æ•°ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…éœ€è¦åç«¯æ”¯æŒï¼‰
                document.getElementById('balance').textContent = currentUser.balance || 0;
                document.getElementById('previewCount').textContent = currentUser.free_previews || 0;
                
                // VIPçŠ¶æ€
                if (currentUser.is_vip) {
                    document.getElementById('vipStatus').textContent = 'VIPä¼šå‘˜';
                    document.getElementById('vipExpiry').textContent = `åˆ°æœŸ: ${currentUser.vip_expiry || '-'}`;
                    document.getElementById('vipBadge').style.display = 'inline-block';
                    document.getElementById('vipBtn').textContent = 'ğŸ’ ç»­è´¹VIP';
                }
                
                // è®¾ç½®é¡µé¢
                document.getElementById('settingUsername').value = currentUser.username;
                document.getElementById('settingEmail').value = currentUser.email || '';
                
            } catch (error) {
                console.error('åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                alert('è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼Œè¯·é‡æ–°ç™»å½•');
            }
        }
        
        // åŠ è½½ä½œå“åˆ—è¡¨
        async function loadWorks() {
            try {
                const response = await fetch('/yuan/api/user/generations', {
                    headers: { 'Authorization': `Bearer ${currentToken}` }
                });
                
                if (!response.ok) throw new Error('è·å–ä½œå“åˆ—è¡¨å¤±è´¥');
                
                const data = await response.json();
                const works = data.generations || [];

                // åªæ˜¾ç¤ºæœ‰é¢„è§ˆå›¾çš„è®°å½•ï¼ˆä¸æ˜¾ç¤ºåŸå›¾ï¼‰
                const validWorks = works.filter(work => {
                    return work.preview_image_url && work.preview_image_url.trim() !== '';
                });

                const grid = document.getElementById('worksGrid');
                if (validWorks.length === 0) {
                    grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“¸</div><p>è¿˜æ²¡æœ‰ä½œå“ï¼Œå¿«å»åˆ›ä½œå§ï¼</p></div>';
                    return;
                }

                grid.innerHTML = validWorks.map(work => {
                    const shortId = work.id.substring(0, 8);

                    return `
                        <div class="work-card" onclick="viewWork('${fixImagePath(work.preview_image_url)}')">
                            <img src="${fixImagePath(work.preview_image_url)}" alt="ä½œå“" class="work-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 200 300%22%3E%3Crect fill=%22%23333%22 width=%22200%22 height=%22300%22/%3E%3C/svg%3E'">
                            <div class="work-info">
                                <div class="work-title">ä½œå“ #${shortId}</div>
                                <div class="work-status ${work.is_paid ? 'status-paid' : 'status-preview'}">
                                    ${work.is_paid ? 'âœ… å·²è´­ä¹°' : 'âš ï¸ é¢„è§ˆç‰ˆ'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('åŠ è½½ä½œå“å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½è®¢å•è®°å½•
        async function loadOrders() {
            // æ¨¡æ‹Ÿè®¢å•æ•°æ®ï¼ˆå®é™…éœ€è¦åç«¯APIï¼‰
            const orders = [];
            
            const list = document.getElementById('orderList');
            if (orders.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“‹</div><p>æš‚æ— æ¶ˆè´¹è®°å½•</p></div>';
                return;
            }
            
            list.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <div class="order-id">è®¢å•å·: ${order.id}</div>
                            <div style="font-size: 0.85rem; opacity: 0.6; margin-top: 5px;">${order.date}</div>
                        </div>
                        <div class="order-amount">Â¥${order.amount}</div>
                    </div>
                    <div class="order-details">
                        <div>ç±»å‹: ${order.type}</div>
                        <div>çŠ¶æ€: <span style="color: var(--main-color);">${order.status}</span></div>
                    </div>
                </div>
            `).join('');
        }
        
        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // å……å€¼ç›¸å…³
        function showRechargeModal() {
            document.getElementById('rechargeModal').style.display = 'flex';
        }
        
        function closeRechargeModal() {
            document.getElementById('rechargeModal').style.display = 'none';
        }
        
        function selectAmount(amount) {
            document.getElementById('rechargeAmount').value = amount;
        }
        
        function showCustomAmount() {
            document.getElementById('rechargeAmount').focus();
        }
        
        async function processRecharge() {
            const amount = document.getElementById('rechargeAmount').value;
            if (!amount || amount <= 0) {
                alert('è¯·è¾“å…¥æ­£ç¡®çš„å……å€¼é‡‘é¢');
                return;
            }
            // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ï¼Œä¼ é€’å……å€¼é‡‘é¢å‚æ•°
            window.location.href = `/yuan/payment.html?type=balance&amount=${amount}`;
        }
        
        // VIPç›¸å…³
        function showVipModal() {
            document.getElementById('vipModal').style.display = 'flex';
        }
        
        function closeVipModal() {
            document.getElementById('vipModal').style.display = 'none';
        }
        
        function selectVipPlan(months, price) {
            selectedVipMonths = months;
            selectedVipPrice = price;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.vip-plan').forEach(plan => {
                plan.style.borderColor = '#333';
            });
            event.currentTarget.style.borderColor = 'var(--main-color)';
        }
        
        async function processVipPurchase() {
            if (!selectedVipMonths || !selectedVipPrice) {
                alert('è¯·é€‰æ‹©VIPå¥—é¤');
                return;
            }
            // è·³è½¬åˆ°æ”¯ä»˜é¡µé¢ï¼Œä¼ é€’VIPå¥—é¤å‚æ•°
            window.location.href = `/yuan/payment.html?type=vip&months=${selectedVipMonths}&price=${selectedVipPrice}`;
        }
        
        // æŸ¥çœ‹ä½œå“
        function viewWork(url) {
            window.open(url, '_blank');
        }
        
        // ä¿å­˜è®¾ç½®
        async function saveSettings() {
            const email = document.getElementById('settingEmail').value;
            alert('ä¿å­˜è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­');
        }
        
        // ä¿®æ”¹å¯†ç 
        function showChangePasswordModal() {
            alert('ä¿®æ”¹å¯†ç åŠŸèƒ½å¼€å‘ä¸­');
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('currentUser');
            location.href = 'index.html';
        }
    </script>
    <script src="/yuan/js/behavior-tracker.js"></script>
</body>
</html>










