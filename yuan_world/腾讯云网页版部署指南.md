# è…¾è®¯äº‘ç½‘é¡µç‰ˆä¸€é”®éƒ¨ç½²æŒ‡å—

## ðŸŒ ä½¿ç”¨è…¾è®¯äº‘åœ¨çº¿ç»ˆç«¯éƒ¨ç½²ï¼ˆæ— éœ€å¯†ç ï¼‰

### ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€åœ¨çº¿ç»ˆç«¯

1. **ç™»å½•è…¾è®¯äº‘æŽ§åˆ¶å°**
2. **æ‰¾åˆ°æ‚¨çš„æœåŠ¡å™¨ (dream)**
3. **ç‚¹å‡»æœåŠ¡å™¨åç§°ï¼Œè¿›å…¥è¯¦æƒ…é¡µ**
4. **æ‰¾åˆ°"ç™»å½•"æŒ‰é’®ï¼Œé€‰æ‹©"OrcaTerm ç»ˆç«¯"**
5. **åœ¨ç½‘é¡µä¸­æ‰“å¼€ Linux ç»ˆç«¯**

### ç¬¬äºŒæ­¥ï¼šåœ¨ç½‘é¡µç»ˆç«¯ä¸­è¿è¡Œå‘½ä»¤

**å¤åˆ¶ä»¥ä¸‹å‘½ä»¤ï¼Œä¸€æ¡ä¸€æ¡æ‰§è¡Œï¼š**

#### 1. æ›´æ–°ç³»ç»Ÿ

```bash
sudo apt update && sudo apt upgrade -y
```

#### 2. å®‰è£… Node.js

```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

#### 3. å®‰è£… PostgreSQL

```bash
sudo apt install postgresql postgresql-contrib -y
sudo systemctl start postgresql
sudo systemctl enable postgresql
```

#### 4. è®¾ç½®æ•°æ®åº“

```bash
sudo -u postgres psql -c "ALTER USER postgres PASSWORD 'postgres';"
sudo -u postgres createdb dreamhome
sudo -u postgres createdb dreamhome_shadow
```

#### 5. å®‰è£… Nginx

```bash
sudo apt install nginx -y
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 6. å®‰è£… PM2 å’Œ Prisma

```bash
sudo npm install -g pm2 prisma
```

#### 7. åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
sudo mkdir -p /var/www/dreamhome
cd /var/www/dreamhome
```

### ç¬¬ä¸‰æ­¥ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

**åœ¨æ‚¨çš„ Windows ç”µè„‘ä¸Šï¼š**

1. **æ‰“åŒ…é¡¹ç›®æ–‡ä»¶**

```bash
# åœ¨D:\dreamç›®å½•ä¸‹è¿è¡Œ
tar -czf dreamhome-deploy.tar.gz --exclude=node_modules --exclude=.svelte-kit --exclude=.git .
```

2. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
   - å¯ä»¥ä½¿ç”¨è…¾è®¯äº‘æŽ§åˆ¶å°çš„æ–‡ä»¶ç®¡ç†åŠŸèƒ½
   - æˆ–è€…ä½¿ç”¨ SCP å‘½ä»¤ï¼š`scp dreamhome-deploy.tar.gz root@49.232.220.223:/tmp/`

### ç¬¬å››æ­¥ï¼šåœ¨æœåŠ¡å™¨ä¸Šç»§ç»­éƒ¨ç½²

**å›žåˆ°ç½‘é¡µç»ˆç«¯ï¼Œç»§ç»­æ‰§è¡Œï¼š**

#### 8. è§£åŽ‹é¡¹ç›®æ–‡ä»¶

```bash
cd /var/www/dreamhome
sudo tar -xzf /tmp/dreamhome-deploy.tar.gz
sudo rm /tmp/dreamhome-deploy.tar.gz
```

#### 9. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
sudo npm install
sudo npm install express
```

#### 10. åˆ›å»ºçŽ¯å¢ƒé…ç½®

```bash
sudo cat > .env.production << 'EOF'
NODE_ENV=production
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/dreamhome
JWT_SECRET=dream-home-super-secret-jwt-key-2024-production
DOUBAO_API_KEY=97e3922f-c817-47d3-8690-6a940a06081f
PUBLIC_APP_URL=http://49.232.220.223
PORT=3000
EOF
```

#### 11. æ•°æ®åº“åˆå§‹åŒ–

```bash
sudo npm run prisma:generate
sudo npm run prisma:push --accept-data-loss
sudo npm run prisma:seed
```

#### 12. æž„å»ºé¡¹ç›®

```bash
sudo npm run build
```

#### 13. åˆ›å»ºå¯åŠ¨è„šæœ¬

```bash
sudo cat > start-production.js << 'EOF'
import { handler } from './build/handler.js';
import express from 'express';

const app = express();
const port = process.env.PORT || 3000;

process.env.NODE_ENV = 'production';
process.env.DATABASE_URL = 'postgresql://postgres:postgres@localhost:5432/dreamhome';
process.env.JWT_SECRET = 'dream-home-super-secret-jwt-key-2024-production';
process.env.DOUBAO_API_KEY = '97e3922f-c817-47d3-8690-6a940a06081f';
process.env.PUBLIC_APP_URL = 'http://49.232.220.223';

app.use(handler);

app.listen(port, () => {
  console.log(`ðŸš€ ç‹—ç‹—é€ æ¢¦å®¶æœåŠ¡å™¨è¿è¡Œåœ¨ç«¯å£ ${port}`);
});
EOF
```

#### 14. åˆ›å»º PM2 é…ç½®

```bash
sudo cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'dreamhome',
    script: 'start-production.js',
    instances: 1,
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true
  }]
};
EOF
```

#### 15. é…ç½® Nginx

```bash
sudo cat > /etc/nginx/sites-available/dreamhome << 'EOF'
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name _;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
EOF
```

#### 16. å¯ç”¨ç½‘ç«™é…ç½®

```bash
sudo rm -f /etc/nginx/sites-enabled/default
sudo ln -sf /etc/nginx/sites-available/dreamhome /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### 17. é…ç½®é˜²ç«å¢™

```bash
sudo ufw allow ssh
sudo ufw allow 80
sudo ufw allow 443
sudo ufw --force enable
```

#### 18. å¯åŠ¨åº”ç”¨

```bash
sudo mkdir -p logs
sudo pm2 start ecosystem.config.js
pm2 startup
sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u ubuntu --hp /home/ubuntu
pm2 save
```

#### 19. è®¾ç½®æƒé™

```bash
sudo chown -R www-data:www-data /var/www/dreamhome
```

### ðŸŽ‰ éƒ¨ç½²å®Œæˆï¼

**æ‚¨çš„ç½‘ç«™åœ°å€ï¼š** http://49.232.220.223

**ç®¡ç†åŽå°ï¼š** http://49.232.220.223/admin

## ðŸ”§ ç®¡ç†å‘½ä»¤

```bash
pm2 status          # æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 logs dreamhome   # æŸ¥çœ‹åº”ç”¨æ—¥å¿—
pm2 restart dreamhome # é‡å¯åº”ç”¨
```

## ðŸ’¡ å°è´´å£«

1. ç¬¬ä¸€æ¬¡è¿è¡Œå¯èƒ½éœ€è¦ç­‰å¾… 1-2 åˆ†é’Ÿ
2. å¦‚æžœè®¿é—®ä¸äº†ï¼Œæ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. å¯ä»¥é€šè¿‡ `pm2 logs` æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
